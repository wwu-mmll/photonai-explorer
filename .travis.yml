language: node_js
os: linux
dist: bionic
jobs:
  include:
    - language: node_js
      os: linux
      dist: bionic
      node_js: 12
      install:
        - npm install
      script:
        - npm run lint
        - npm run build
    - language: go
      os: linux
      dist: bionic
      go: 1.14.x
      node_js: 12
      before_install:
        - sudo apt update
        - sudo apt-get -y install gcc libgtk-3-dev libappindicator3-dev webkit2gtk-4.0
      install:
        - npm install
        - go get -u github.com/gobuffalo/packr/packr
        - go get -u github.com/akavel/rsrc
      script:
        - npm run lint
        - npm run build
        - cd photonai-explorer-serv/
        - rm -r ./dist/
        - cp -r ../dist/ ./dist/
        - $GOPATH/bin/packr
        - go build -o photonai_explorer .
        - rsrc -manifest photonai_explorer.manifest
        - env GOOS=windows GOARCH=amd64 go build -ldflags="-H windowsgui" -o photonai_explorer.exe .
    - language: go
      os: osx
      go: 1.14.x
      node_js: 12
      addons:
        homebrew:
          packages:
            - graphicsmagick
            - imagemagick
          update: true
      before_install:
        - npm install --global create-dmg
      install:
        - npm install
        - go get -u github.com/gobuffalo/packr/packr
      script:
        - npm run lint
        - npm run build
        - cd photonai-explorer-serv/
        - rm -r ./dist/
        - cp -r ../dist/* ./dist/
        - $GOPATH/bin/packr
        - go build -o ./.build-mac/PHOTONAI\ Explorer.app/Contents/MacOS/photonai_explorer_mac .
        - cd ./.build-mac/
        - create-dmg PHOTONAI\ Explorer.app || a=$?; if [ $a -eq 2 ]; then return 0; else return $a; fi # ignore error code 2

